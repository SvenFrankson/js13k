function scaleColor(t,e){let s=7===t.length?1:0,i=mf(pi(t.substring(s,s+2),16)*e),n=mf(pi(t.substring(s+2,s+4),16)*e),h=mf(pi(t.substring(s+4,s+6),16)*e);return(1===s?"#":"")+i.toString(16).padStart(2,"0")+n.toString(16).padStart(2,"0")+h.toString(16).padStart(2,"0")}function lerpColor(t,e,s){let i=7===t.length?1:0,n=pi(t.substring(i,i+2),16),h=pi(t.substring(i+2,i+4),16),r=pi(t.substring(i+4,i+6),16),p=pi(e.substring(i,i+2),16),l=pi(e.substring(i+2,i+4),16),o=pi(e.substring(i+4,i+6),16),a=mf(n*(1-s)+p*s),c=mf(h*(1-s)+l*s),d=mf(r*(1-s)+o*s);return(1===i?"#":"")+a.toString(16).padStart(2,"0")+c.toString(16).padStart(2,"0")+d.toString(16).padStart(2,"0")}function play(){if(playing)return;document.getElementById("play").style.display="none",document.getElementById("score").style.display="",sc=0,gk=0,playing=!0;let t=new Engine(gw,gh),e=new Blob(t);t.blob=e;let s=()=>{t.update(),t.draw(),playing?requestAnimationFrame(s):t.dstr()};s(),t.cnv.addEventListener("pointerdown",s=>{if(1===e.nT){e.cbo=1,e.pA.x=s.clientX-bLeft+t.cX-.5*t.w,e.pA.y=s.clientY-bTop+t.cY-.5*t.h;let i=e.pA.x-e.pB.x,n=e.pA.y-e.pB.y;i*i+n*n<3600&&(e.nFrz=!0)}}),t.cnv.addEventListener("pointermove",s=>{e.nFrz&&(e.pA.x=s.clientX-bLeft+t.cX-.5*t.w,e.pA.y=s.clientY-bTop+t.cY-.5*t.h)}),t.cnv.addEventListener("pointerup",t=>{e.nFrz&&e.brk()})}function gameready(){let t=document.getElementById("play");t.style.display="",t.innerText="PLAY",t.onpointerup=play,playing=!1,document.getElementById("score").style.display="none"}function gameover(){playing=!1,document.getElementById("score").style.display="none";let t=document.getElementById("play");t.style.display="",t.innerText="GAME OVER\n"+sc.toFixed(0).padStart(6,"0");let e=0,s=()=>{e++,t.style.opacity=e*e/180/180,e<180?requestAnimationFrame(s):(t.style.opacity=1,t.onpointerup=gameready)};s()}function resize(){gw=window.innerWidth,gw=Math.min(gw,1e3),gh=window.innerHeight,gh=Math.min(gh,1e3);let t=document.getElementById("play");t.style.width="400px",t.style.left=(.5*gw-200).toFixed(0)+"px",t.style.top=(.5*gh).toFixed(0)+"px",bLeft=.5*window.innerWidth-.5*gw,document.body.style.left=bLeft.toFixed(0)+"px"}var gw=500,gh=500,bTop=0,bLeft=0,gk=0,mf=Math.floor,mr=Math.random,mc=Math.cos,ms=Math.sin,pi=parseInt,sc=0,cBlk="#475250",cLBlk="#556663",cGrn="#b5eecb";class Engine{constructor(t,e){let s=this;s.cX=0,s.cY=0,s.w=t,s.h=e,s.cnv=document.getElementsByTagName("canvas")[0],s.cnv.width=s.w,s.cnv.height=s.h,s.ctx=s.cnv.getContext("2d"),s.gos=[],s.txts=[],s.tiles=[];let i=document.createElement("canvas");i.width=2*t,i.height=2*e;let n=i.getContext("2d");n.fillStyle=cBlk,n.fillRect(0,0,2*t,2*e);for(let s=0;s<20;s++){n.lineWidth=1;let s=2*mr()*t,i=2*mr()*e,h=200*mr()+50;for(let r=-1;r<=1;r++)for(let p=-1;p<=1;p++)n.beginPath(),n.arc(2*r*t+s,2*p*e+i,h,0,2*Math.PI),n.strokeStyle=cLBlk,n.stroke()}s.bgData=n.getImageData(0,0,2*t,2*e)}dstr(){for(;this.gos[0];)this.gos[0].dstr()}update(){let t=this;if(gk++,t.updateTiles(),t.gos.forEach(t=>{t.update&&t.update()}),t.blob&&(t.blob.update(),!t.blob.nFrz)){let e=.5*(t.blob.pN.x+t.blob.pB.x),s=.5*(t.blob.pN.y+t.blob.pB.y),i=e-t.cX;i>2*t.blob.nT&&(i=2*t.blob.nT),i<2*-t.blob.nT&&(i=2*-t.blob.nT);let n=s-t.cY;n>2*t.blob.nT&&(n=2*t.blob.nT),n<2*-t.blob.nT&&(n=2*-t.blob.nT),t.cX+=i,t.cY+=n}document.getElementById("score").innerText=sc.toFixed(0).padStart(6,"0")}updateTiles(){let t=this;if(t.blob){let e=Math.floor(t.blob.pB.x/2e3),s=Math.floor(t.blob.pB.y/2e3),i=[],n=0;for(;n<t.tiles.length;){let h=t.tiles[n];Math.abs(h.i-e)<3&&Math.abs(h.j-s)<3?(i.push(h),t.tiles.splice(n,1)):n++}t.tiles.forEach(t=>{t.dstr()});for(let n=-1;n<2;n++)for(let h=-1;h<2;h++)if(!i.find(t=>t.i===e+n&&t.j===s+h)){let r=new Tile(t,e+n,s+h);r.inst(),i.push(r)}t.tiles=i}t.tiles.forEach(t=>{t.update()})}draw(){let t=this,e=-t.cX;for(;e<0;)e+=2*t.w;for(;e>2*t.w;)e-=2*t.w;let s=-t.cY;for(;s<0;)s+=2*t.h;for(;s>2*t.h;)s-=2*t.h;t.ctx.putImageData(t.bgData,e,s),t.ctx.putImageData(t.bgData,e-2*t.w,s),t.ctx.putImageData(t.bgData,e,s-2*t.h),t.ctx.putImageData(t.bgData,e-2*t.w,s-2*t.h),t.gos.forEach(t=>{t.draw&&t.draw()}),t.blob&&t.blob.draw(),t.txts.forEach(t=>{t.draw&&t.draw()})}}class Tile{constructor(t,e,s){let i=this;i.en=t,i.i=e,i.j=s,i.x=2e3*e,i.y=2e3*s,i.k=0,i.stns=[],i.spks=[],i.cons=[],i.strs=[]}rx(){return this.x+2e3*mr()}ry(){return this.y+2e3*mr()}addStone(){let t=new Stone(this,2+mf(5*mr()),5+10*mr());t.p.x=this.rx(),t.p.y=this.ry(),this.check(t.p.x,t.p.y)&&(t.inst(),this.stns.push(t))}addSpike(){let t=new Spike(this,1+mf(3*mr()),2+5*mr());t.p.x=this.rx(),t.p.y=this.ry(),this.check(t.p.x,t.p.y)&&(t.inst(),this.spks.push(t))}addCoin(){let t=new Coin(this,1+mf(3*mr()),2+5*mr());t.p.x=this.rx(),t.p.y=this.ry(),this.check(t.p.x,t.p.y)&&(t.inst(),this.cons.push(t))}addStruct(){let t,e=mr();t=e<.25?new Tunnel(this,300):e<.5?new Shell(this,200):e<.75?new Snake(this,400):new HotCore(this,150),t.p.x=this.rx(),t.p.y=this.ry(),this.check(t.p.x,t.p.y)&&(t.dir=mr()*Math.PI*2,t.inst(),this.strs.push(t))}check(t,e){return Math.abs(t-this.en.blob.pB.x)>200&&Math.abs(t-this.en.blob.pB.x)>200}inst(){for(let t=0;t<20;t++)this.addStone();for(let t=0;t<8;t++)this.addSpike();for(let t=0;t<12;t++)this.addCoin();for(let t=0;t<4;t++)this.addStruct()}dstr(){let t=[...this.stns,...this.spks,...this.cons,...this.strs];t.forEach(t=>{t.dstr(!0)})}update(){this.cons.length<12*(1+gk/3600)&&this.addCoin(),this.spks.length<8*(1+gk/3600)&&this.addSpike(),this.strs.length<4*(1+gk/3600)&&this.addStruct()}}class GameObject{constructor(t){this.t=t,this.en=t.en}inst(){this.en.gos.push(this)}dstr(){let t=this.en.gos.indexOf(this);-1!==t&&this.en.gos.splice(t,1),this.dstryd=!0}}class FloatingText{constructor(t,e){this.en=t,this.t=e,this.s=1,this.k=0,this.p={x:0,y:0},this.dx=2*mr()-1,this.dy=2*mr()}inst(){this.en.txts.push(this)}dstr(){let t=this.en.txts.indexOf(this);-1!==t&&this.en.txts.splice(t,1)}draw(){this.k++,this.s=20*Math.sin(this.k/60*Math.PI);let t=this.en.ctx,e=.5*this.en.w-this.en.cX,s=.5*this.en.h-this.en.cY,i=e+this.p.x+this.k*this.dx,n=s+this.p.y-2*this.k*this.dy;t.font=this.s.toFixed(0)+"px Arial",t.textAlign="center",t.fillStyle="white",t.fillText(this.t,i,n),this.k>60&&this.dstr()}}class Disc extends GameObject{constructor(t,e,s,i){super(t),this.type="disc",this.s=e,this.r=10*e,this.h=s,this.p={x:0,y:0},this.color=i,this.colorShadow=scaleColor(i,.5)}dstr(t){if(!t){let t=new DstryDisc(this);t.inst()}super.dstr()}draw(){let t=this,e=t.en.ctx;e.lineWidth=2;let s=.5*t.en.w-t.en.cX,i=.5*t.en.h-t.en.cY,n=s+t.p.x,h=i+t.p.y;if(n>-20-t.r&&h>-20-t.r&&n<t.en.w+20+t.r&&h<t.en.h+20+t.r){let s=t.h-2*t.h*n/t.en.w,i=t.h-2*t.h*h/t.en.h;e.beginPath(),e.arc(n+s,h+i,t.r,0,2*Math.PI),e.strokeStyle=t.colorShadow,e.stroke(),e.beginPath(),e.arc(n,h,t.r,0,2*Math.PI),e.strokeStyle=t.color,e.stroke()}}collide(t,e,s){let i=t-this.p.x,n=e-this.p.y,h=i*i+n*n;return h<(s+this.r)*(s+this.r)}collisionNormal(t,e,s){let i=t-this.p.x,n=e-this.p.y,h=i*i+n*n;if(h<(s+this.r)*(s+this.r)){let t=Math.sqrt(h),e={x:i/t,y:n/t};return e}}}class DstryDisc extends Disc{constructor(t){super(t.t,t.s,t.h,t.color),this.type="dstryd",this.p=t.p}dstr(){super.dstr(!0)}update(){this.r*=.8,this.r<1&&this.dstr()}}class Structure extends GameObject{constructor(t,e){super(t),this.dir=0,this.k=0,this.p={x:0,y:0},this.r=e,this.a=0}inst(){this.en.gos.push(this),this.coins.forEach(t=>{t.inst()}),this.spikes.forEach(t=>{t.inst()})}dstr(){let t=this.en.gos.indexOf(this);-1!==t&&this.en.gos.splice(t,1),t=this.t.strs.indexOf(this),-1!==t&&this.t.strs.splice(t,1),this.coins.forEach(t=>{t.dstr()}),this.spikes.forEach(t=>{t.dstr()})}check(){let t=!1;return this.coins.forEach(e=>{e.dstryd||(t=!0)}),t?(t=!1,this.spikes.forEach(e=>{e.dstryd||(t=!0)}),!!t||(this.dstr(),!1)):(this.dstr(),!1)}update(){let t=mc(this.dir),e=mc(this.dir);this.p.x+=.2*t,this.p.y+=.2*e,this.dir=mc(this.k/1e3)*Math.PI,this.k++,this.a+=Math.PI/1200}}class Tunnel extends Structure{constructor(t,e){super(t,e),this.coins=[new Coin(t,2,5),new Coin(t,2,5),new Coin(t,2,5),new Coin(t,2,5)],this.spikes=[new Spike(t,1,5),new Spike(t,1,5),new Spike(t,1,5),new Spike(t,1,5)]}update(){if(this.check()){super.update();let t=mc(this.a),e=ms(this.a);this.coins.forEach((s,i)=>{s.p.x=t*this.r*(i-2)/3+this.p.x,s.p.y=e*this.r*(i-2)/3+this.p.y}),this.spikes.forEach((s,i)=>{let n=this.coins[i],h=i%2==0?1:-1;s.p.x=n.p.x+h*e*this.r/3,s.p.y=n.p.y-h*t*this.r/3})}}}class Shell extends Structure{constructor(t,e){super(t,e),this.coins=[new Coin(t,2,5),new Coin(t,2,5),new Coin(t,2,5),new Coin(t,2,5)],this.spikes=[new Spike(t,1,5),new Spike(t,1,5),new Spike(t,1,5),new Spike(t,1,5)]}update(){this.check()&&(super.update(),this.coins.forEach((t,e)=>{let s=mc(this.a+e*Math.PI/2),i=ms(this.a+e*Math.PI/2);t.p.x=s*this.r/3+this.p.x,t.p.y=i*this.r/3+this.p.y}),this.spikes.forEach((t,e)=>{let s=mc(this.a+e*Math.PI/2),i=ms(this.a+e*Math.PI/2);t.p.x=s*this.r+this.p.x,t.p.y=i*this.r+this.p.y}))}}class HotCore extends Structure{constructor(t,e){super(t,e),this.coins=[new Coin(t,2,5),new Coin(t,2,5),new Coin(t,2,5),new Coin(t,2,5)],this.spikes=[new Spike(t,1,5),new Spike(t,1,5),new Spike(t,1,5),new Spike(t,1,5)]}update(){if(this.check()){super.update();let t=this;t.coins.forEach((e,s)=>{let i=mc(t.a+s*Math.PI/2),n=ms(t.a+s*Math.PI/2);e.p.x=i*t.r+t.p.x,e.p.y=n*t.r+t.p.y}),t.spikes.forEach((e,s)=>{let i=mc(t.a+s*Math.PI/2+Math.PI/4),n=ms(t.a+s*Math.PI/2+Math.PI/4);e.p.x=i*t.r*.5+t.p.x,e.p.y=n*t.r*.5+t.p.y})}}}class Snake extends Structure{constructor(t,e){super(t),this.l=e,this.r=e/6,this.coins=[new Coin(t,2,5),new Coin(t,2,5),new Coin(t,2,5),new Coin(t,2,5)],this.spikes=[new Spike(t,1,5)]}update(){if(this.check()){let t=this.en.blob,e=t.pN.x-this.p.x,s=t.pN.y-this.p.y,i=Math.sqrt(e*e+s*s);e/=i,s/=i,i<250?(this.p.x+=.5*e,this.p.y+=.5*s):super.update(),this.spikes[0].p.x=this.p.x,this.spikes[0].p.y=this.p.y;let n=this.spikes[0];for(let t=0;t<this.coins.length;t++){let e=this.coins[t];if(e){let t=e.p.x-n.p.x,s=e.p.y-n.p.y,i=t*t+s*s;i>this.r*this.r&&(i=Math.sqrt(i),t/=i,s/=i,e.p.x=n.p.x+t*this.r,e.p.y=n.p.y+s*this.r),n=e}}}}}var coins=[];class Coin extends Disc{constructor(t,e,s){super(t,e,s,"#b5eecb"),this.type="coin"}inst(){super.inst(),coins.push(this)}dstr(){super.dstr();let t=coins.indexOf(this);-1!==t&&coins.splice(t,1),t=this.t.cons.indexOf(this),-1!==t&&this.t.cons.splice(t,1)}}class Spike extends Disc{constructor(t,e,s){super(t,e,s,"#f8a2a8"),this.type="spike"}dstr(){super.dstr();let t=this.t.spks.indexOf(this);-1!==t&&this.t.spks.splice(t,1)}}class Stone extends Disc{constructor(t,e,s){super(t,e,s,"#9589a9"),this.type="stone",this.bmp=0,this.bmpg=!1}draw(){let t=this;t.bmpg?(t.bmp+=1+.5*t.s,t.bmpg=t.bmp<3*t.size):t.bmp=Math.max(t.bmp-.5,0);let e=t.en.ctx;e.lineWidth=2;let s=.5*t.en.w-t.en.cX,i=.5*t.en.h-t.en.cY,n=s+t.p.x,h=i+t.p.y;if(n>-20-t.r&&h>-20-t.r&&n<t.en.w+20+t.r&&h<t.en.h+20+t.r){let s=t.h-2*t.h*n/t.en.w,i=t.h-2*t.h*h/t.en.h;e.beginPath(),e.arc(n+s,h+i,t.r+t.bmp,0,2*Math.PI),e.strokeStyle=t.colorShadow,e.stroke(),e.beginPath(),e.arc(n,h,t.r+t.bmp,0,2*Math.PI),e.strokeStyle=t.color,e.stroke()}}}class Blob{constructor(t){let e=this;e.en=t,e.cbo=1,e.hpM=20,e.hp=e.hpM,e.sk=6,e.mBod=3,e.mNuc=1,e.nFrz=!1,e.nT=1,e.pN={x:50,y:30},e.vN={x:0,y:0},e.pB={x:-50,y:20},e.vB={x:0,y:0},e.pA={x:0,y:0},e.flk=0}draw(){let t=this;if(!playing)return;let e=t.en.ctx,s=.5*t.en.w-t.en.cX,i=.5*t.en.h-t.en.cY,n=20,h=30,r=t.pB.x-t.pN.x,p=t.pB.y-t.pN.y,l=Math.sqrt(r*r+p*p);r/=l,p/=l,h-=l/10,h=Math.max(h,n),t.flk=Math.max(t.flk-1,0);let o=lerpColor(cGrn,cBlk,.9*(1-t.hp/t.hpM)+.1);if(t.flk>0){let e=.5*Math.cos(t.flk*Math.PI*2/60*6)+.5;o=lerpColor(o,"#f8a2a8",e)}e.beginPath(),e.arc(s+t.pB.x,i+t.pB.y,h+2,0,2*Math.PI),e.fillStyle=o,e.fill();for(let h=0;h<.5*l;h+=2){let o=1-h/(.5*l);o*=o;let a=n*o+.5*n*(1-o);e.beginPath(),e.arc(s+t.pN.x+r*h,i+t.pN.y+p*h,a+2,0,2*Math.PI),e.fill()}for(let o=.5*l;o<l;o+=2){let a=(o-.5*l)/(.5*l);a=Math.pow(a,1.5);let c=.5*n*(1-a)+h*a;e.beginPath(),e.arc(s+t.pN.x+r*o,i+t.pN.y+p*o,c+2,0,2*Math.PI),e.fill()}e.beginPath(),e.arc(s+t.pN.x,i+t.pN.y,n+2,0,2*Math.PI),e.fill(),e.fillStyle=cBlk,e.beginPath(),e.arc(s+t.pB.x,i+t.pB.y,h,0,2*Math.PI),e.fill();for(let h=0;h<.5*l;h+=2){let o=1-h/(.5*l);o*=o;let a=n*o+.5*n*(1-o);e.beginPath(),e.arc(s+t.pN.x+r*h,i+t.pN.y+p*h,a,0,2*Math.PI),e.fill()}for(let o=.5*l;o<l;o+=2){let a=(o-.5*l)/(.5*l);a=Math.pow(a,1.5);let c=.5*n*(1-a)+h*a;e.beginPath(),e.arc(s+t.pN.x+r*o,i+t.pN.y+p*o,c,0,2*Math.PI),e.fill()}e.beginPath(),e.arc(s+t.pN.x,i+t.pN.y,n,0,2*Math.PI),e.fill()}brk(){this.nFrz=!1,this.nT=0}update(){let t=this;t.hp<=0&&gameover(sc),t.nFrz?t.nT-=1/120:(t.nT+=1/90,t.nT=Math.min(t.nT,1)),t.nT<0&&t.brk();let e=t.pB.x-t.pN.x,s=t.pB.y-t.pN.y,i=Math.sqrt(e*e+s*s);if(i>250&&t.nFrz&&t.brk(),i>0){e/=i,s/=i;let n=-e,h=-s;t.vN.x+=e*i*t.sk/60/t.mNuc,t.vN.y+=s*i*t.sk/60/t.mNuc,t.vB.x+=n*i*t.sk/60/t.mBod,t.vB.y+=h*i*t.sk/60/t.mBod}coins=coins.sort((e,s)=>{let i=e.p.x-t.pN.x;i*=i;let n=e.p.y-t.pN.y;n*=n;let h=s.p.x-t.pN.x;h*=h;let r=s.p.y-t.pN.y;return r*=r,i+n-(h+r)});let n=coins[0];if(n){let e=n.p.x-t.pN.x,s=n.p.y-t.pN.y,i=Math.sqrt(e*e+s*s);if(i>0){e/=i,s/=i;let n=50/(i/100)/(i/100);e*=n/60/t.mNuc,s*=n/60/t.mNuc,t.vN.x+=e,t.vN.y+=s}}if(t.nFrz){let e=t.pA.x-t.pB.x,s=t.pA.y-t.pB.y,i=Math.sqrt(e*e+s*s);i>0&&(e/=i,s/=i,t.vB.x+=e*i*t.sk*100/60/t.mBod,t.vB.y+=s*i*t.sk*100/60/t.mBod)}t.vN.x*=.99*t.nT,t.vN.y*=.99*t.nT,t.vB.x*=.9925*(.8+(t.nFrz?0:.2)),t.vB.y*=.9925*(.8+(t.nFrz?0:.2));for(let e=0;e<t.en.gos.length;e++){let s=t.en.gos[e];if(s.collide){let e=s.collide(t.pB.x,t.pB.y,30);if(e)if("stone"===s.type){let e=s.collisionNormal(t.pB.x,t.pB.y,30),i=t.vB.x*e.x+t.vB.y*e.y;t.pB.x=s.p.x+e.x*(30+s.r+1),t.pB.y=s.p.y+e.y*(30+s.r+1),t.vB.x-=2*i*e.x,t.vB.y-=2*i*e.y,s.bmpg=!0}else"spike"===s.type&&(t.flk=60,t.hp=Math.max(t.hp-s.s,0),s.dstr(),t.cbo=1);let i=s.collide(t.pN.x,t.pN.y,20);if(i)if("stone"===s.type){let e=s.collisionNormal(t.pN.x,t.pN.y,20),i=t.vN.x*e.x+t.vN.y*e.y;t.pN.x=s.p.x+e.x*(20+s.r+1),t.pN.y=s.p.y+e.y*(20+s.r+1),t.vN.x-=2*i*e.x,t.vN.y-=2*i*e.y,s.bmpg=!0}else if("coin"===s.type){sc+=s.s*t.cbo;let e=new FloatingText(t.en,"+ "+(s.s*t.cbo).toFixed(0));e.p.x=t.pB.x,e.p.y=t.pB.y,e.inst(),s.dstr(),t.cbo+=1}else"spike"===s.type&&(t.flk=60,t.hp=Math.max(t.hp-s.s,0),s.dstr(),t.cbo=1)}}t.pN.x+=t.vN.x/60,t.pN.y+=t.vN.y/60,t.pB.x+=t.vB.x/60,t.pB.y+=t.vB.y/60}}var playing=!1;window.addEventListener("load",()=>{resize(),play(),requestAnimationFrame(gameready)});